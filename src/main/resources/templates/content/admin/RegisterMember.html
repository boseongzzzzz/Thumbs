<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" type="text/css" href="../css/sidebar.css">
    <link rel="stylesheet" type="text/css" href="../css/Manage.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    </script>


    <title>관리자 페이지</title>
</head>

<body>
<header>
    <div style="width:100%; float:right;">
        <div style="float: right; margin-right: 20px">
            <div style="float: left; margin-right: 30px">
                <h4 th:text="'관리자 계정 `'+ ${userId} +'` 로그인 중...'"></h4>
            </div>
            <div style="float: right;">
                <a href="/logout"><h4 style="font-weight: bold;">로그아웃</h4></a>
            </div>

        </div>
    </div>
</header>
<aside>
    <img class="logo" src="/image/THUMBS.png" alt="THUMBS.png">
    <div style="margin: 0px auto; text-align: center;">
        <div style="padding: 10px;">
            <h3>사원 관리</h3>
            <div style="margin: 10px; padding: 10px; clear: both;">
                <span><a href="/manage/register-member">신규 사원 추가</a></span><br><br>
                <span><a href="#">사원 정보 변경</a></span><br><br>
                <span><a href="#">사원 권한 변경</a></span><br><br>
            </div>
            <h3>부서 관리</h3>
            <div style="margin: 10px; padding: 10px; clear: both;">
                <span><a href="#">부서 편집</a></span><br><br>
            </div>
            <h3>문서 관리</h3>
            <div style="margin: 10px; padding: 10px; clear: both;">
                <span><a href="#">문서 복구</a></span><br><br>
            </div>
        </div>
    </div>
</aside>
<main>
    <div style="height: 100px; margin:10px; padding:10px"> <!-- 기본 폼 : 선택한 서식 및 현재 작업을 알려주는 헤드라인 -->
        <h1>신규 사원 추가</h1>
    </div>

    <div class="container">
        <form id="newMember" action="/manage/register-member" method="post">

            <fieldset>
                <!--                <legend>Essential Information</legend>-->
                <div style="clear: both; height: 620px; clear:both; border:1px solid lightgray; margin:10px; padding:50px; width:100%;">
                    <h2>필수 입력 사항</h2><br>
                    <div style="clear:both; border:1px solid lightgray; margin:10px; padding:30px; width:48%;">
                        <div style="clear:both; display: flex; width: 100%;">
                            <div class="col-md-4">
                                <label for="memberId" style="text-align: center; font-size: 15px;">사원 번호 (아이디) :</label>
                            </div>
                            <div class="col-md-8">
                                <input type="number" class="form-control" id="memberId" name="essential.memberId"
                                       placeholder="( 숫자만 입력 가능합니다. )"
                                       style="text-align: center; display: inline-block;" required>
                            </div>
                        </div>
                        <br>
                        <div style="clear: both; display: flex; width: 100%;">
                            <div class="col-md-4">
                                <label for="memberPw" style="text-align: center; font-size: 15px;">비밀번호 :</label>
                            </div>
                            <div class="col-md-8">
                                <input type="text" class="form-control" id="memberPw" name="essential.memberPw"
                                       placeholder="비밀번호를 입력하세요."
                                       style="text-align: center; display: inline-block;" required>
                            </div>
                        </div>
                        <br>
                        <div style="clear: both; display: flex; width: 100%;">
                            <div class="col-md-4">
                                <label for="memberPwCon" style="text-align: center; font-size: 15px;">비밀번호 확인 :</label>
                            </div>
                            <div class="col-md-8">
                                <input type="text" class="form-control" id="memberPwCon" name="essential.memberPwCon"
                                       placeholder="(위의 비밀번호와 같아야 합니다.)"
                                       style="text-align: center; display: inline-block;" required>
                            </div>
                        </div>
                    </div>
                    <div style="clear: both;">
                        <div style="float:left; border:1px solid lightgray; margin:10px; padding:30px; width:48%;">
                            <div style="clear: both; display: flex; width: 100%;">
                                <div class="col-md-4">
                                    <label for="memberName" style="text-align: center; font-size: 15px;">이름 :</label>
                                </div>
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="memberName" name="essential.memberName"
                                           placeholder="이름을 입력하세요."
                                           style="text-align: center; display: inline-block;" required>
                                </div>
                            </div>
                            <br>
                            <div style="clear: both; display: flex; width: 100%;">
                                <div class="col-md-4">
                                    <label for="memberGender" style="text-align: center; font-size: 15px;">성별 :</label>
                                </div>
                                <div class="col-md-8">
                                    <select class="form-select" name="essential.memberGender" id="memberGender"
                                            style="text-align: center; height: 30px; width:100%;" required>
                                        <option value="">선택하세요.</option>
                                        <option value="F">여성</option>
                                        <option value="M">남성</option>
                                    </select>
                                </div>
                            </div>
                            <br>
                            <div style="clear:both; display: flex; width: 100%;">
                                <div class="col-md-4">
                                    <label for="memberRegNo" style="text-align: center; font-size: 15px;">주민등록번호
                                        :</label>
                                </div>
                                <div class="col-md-8">
                                    <input type="number" class="form-control" id="memberRegNo"
                                           name="essential.memberRegNo"
                                           placeholder="( - 제외, 숫자만 입력 하세요. )"
                                           style="text-align: center; display: inline-block;" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="float: right; border:1px solid lightgray; margin:10px; padding:30px; width:48%;">
                        <div style="clear: both; display: flex; width: 100%;">
                            <div class="col-md-4">
                                <label for="authority" style="text-align: center; font-size: 15px;">권한 설정 :</label>
                            </div>
                            <div class="col-md-8">
                                <select class="form-select" id="authority" name="essential.authority"
                                        style="text-align: center; height: 30px; width:100%;" required>
                                    <option value="">선택하세요.</option>
                                    <option value="EMPLOYEE">일반 사원</option>
                                    <option value="DOCU">문서 담당자</option>
                                    <option value="INSA">인사 담당자</option>
                                    <option value="ADMIN">프로그램 관리자</option>
                                </select>
                            </div>
                        </div>
                        <br>
                        <div style="clear: both; display: flex; width: 100%;">
                            <div class="col-md-4">
                                <label for="memberStatus" style="text-align: center; font-size: 15px;">상태 설정 :</label>
                            </div>
                            <div class="col-md-8">
                                <select class="form-select" id="memberStatus" name="essential.memberStatus"
                                        style="text-align: center; height: 30px; width:100%;" required>
                                    <option value="">선택하세요.</option>
                                    <option value="1">신규 사원</option>
                                    <option value="2">복직 사원</option>
                                    <option value="3">휴직(유급) 사원</option>
                                    <option value="4">휴직(무급) 사원</option>
                                    <option value="5">정직 사원</option>
                                </select>
                            </div>
                        </div>
                        <br>
                        <div style="clear: both; display: flex; width: 100%;">
                            <div class="col-md-4">
                                <label for="joinDate" style="text-align: center; font-size: 15px;">입사일 :</label>
                            </div>
                            <div class="col-md-8">
                                <input type="text" class="form-control" id="joinDate" name="essential.joinDate"
                                       placeholder="일자를 선택하세요.">
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
            <fieldset>
                <!--                <legend>Additional Information</legend>-->
                <div style="height: 430px; clear:both; border:1px solid lightgray; margin:10px; padding:50px; width:100%;">
                    <h2>선택 입력 사항</h2>
                    <div style="clear: both;">
                        <div style="float:left; border:1px solid lightgray; margin:10px; padding:30px; width:48%;">
                            <div style="clear: both; display: flex; width: 100%;">
                                <div class="col-md-4">
                                    <label for="memberEmail" style="text-align: center; font-size: 15px;">이메일 :</label>
                                </div>
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="memberEmail"
                                           name="additional.memberEmail" placeholder="이메일을 입력하세요."
                                           style="text-align: center; display: inline-block;">
                                </div>
                            </div>
                            <br>
                            <div style="clear: both; display: flex; width: 100%;">
                                <div class="col-md-4">
                                    <label for="memberAddress" style="text-align: center; font-size: 15px;">주소 :</label>
                                </div>
                                <div class="col-md-8">
                        <textarea class="form-control" id="memberAddress" name="additional.memberAddress" rows="2"
                                  placeholder="거주지 주소를 입력하세요." style="width: 100%"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="float: right; border:1px solid lightgray; margin:10px; padding:30px; width:48%;">
                        <div style="clear: both; display: flex; width: 100%;">
                            <div class="col-md-4">
                                <label for="memberIntroduction" style="text-align: center; font-size: 15px;">자기 소개
                                    :</label>
                            </div>
                            <div class="col-md-8">
                                <textarea class="form-control" id="memberIntroduction"
                                          name="additional.memberIntroduction" rows="5"
                                          placeholder="자기소개를 입력하세요." style="width: 100%"></textarea>
                            </div>
                        </div>
                    </div>
                    <!-- 기본 폼 : 붙임문서(첨부파일) 추가 -->
                    <div style="float:left; margin:10px; width: 100%;">
                        <label for="file" style="font-size: 23px;">회원 사진 :</label>
                        <br>
                        <input type="file" style="border:none" id="file" class="img-thumbnail" accept="pictures/*">
                    </div>
                    <!--        &lt;!&ndash; 미리보기 &ndash;&gt; -->
                    <!--        <div id="showImg2">-->
                    <!--            <img id="showImg" style="width: 250px; height: 150px;">-->
                    <!--            <br><br>-->
                    <!--        </div>-->

                </div>
            </fieldset>
        </form>


        <script>
            $('input[type=file]').on("change", (function () {
                let formData = new FormData();
                formData.append("file", $("#file")[0].files[0]);

                $.ajax({
                    url: "register-member/addPicture",
                    type: 'post',
                    processData: false,
                    contentType: false,
                    cache: false,
                    data: formData,
                    success: function (pictureMember) {
                        alert("사진업로드에 성공하였습니다!");
                        $('#pictureMember').val(pictureMember);
                    }
                    , error: function () {
                        alert("실패하였습니다.");
                    }
                })
            }));
        </script>
        <!-- 숨겨진 필드 -->
        <div style="display:none">
            <!--        <input name="refundRule" th:value="${ param.refundRule }">-->
            <!--        <input name="tel" th:value="${ param.tel }">-->
            <!--        <input name="pjEmail" th:value="${ param.pjEmail }">-->
            <input name="memberPicture" id="memberPicture" th:value="${ param.memberPicture }">
        </div>

        <div style="clear:both; height: 100px;"> <!-- 기본 폼 : 임시저장 및 제출 -->
            <br>
            <div style="float: right; margin:10px; padding:10px;">
                <button class="btn btn-primary" onclick="submitForm()">사원 등록</button>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-treeview/1.2.0/bootstrap-treeview.min.js"></script>
    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>

    <script>

        // 달력 초기 설정
        $(function () {
            $('#joinDate').datepicker({
                format: "yyyy-mm-dd",
                autoclose: true,
                todayHighlight: true,
                immediateUpdate: true,
                title: "입사 일자",
            });

        });


        // 등록 버튼 눌렀을 시 처리
        function submitForm() {

            let message = "";
            let check = true;

            // 사원번호 null 체크
            function checkMemberIdIsNull() {
                let memberId = document.getElementById("memberId").value.trim();
                if (memberId === "") {
                    message = "사원번호를 입력해주세요.";
                    check = false;
                }
                check = true;
            }

            // 사원번호 숫자값 체크
            function checkMemberId() {
                let memberId = document.getElementById("memberId");
                if (isNaN(memberId.value)) {
                    message = "사원번호는 숫자만 가능합니다.";
                    memberId.value = "";
                    check = false;
                }
                check = true;
            }

            // 비밀번호 null 체크
            function checkMemberPwIsNull() {
                let memberPw = document.getElementById("memberPw").value.trim();
                if (memberPw === "") {
                    message = "비밀번호를 입력해주세요.";
                    check = false;
                }
                check = true;
            }

            // 비밀번호 동일 체크
            function checkMemberPw() {
                let memberPw = document.getElementById("memberPw");
                let memberPwCon = document.getElementById("memberPwCon");
                if (memberPw.value != memberPwCon.value) {
                    message = "비밀번호와 비밀번호 확인란의 입력 부분이 다릅니다.";
                    memberPw.value = "";
                    memberPwCon.value = "";
                    check = false;
                }
                check = true;
            }

            // 이름 null 체크
            function checkMemberNameIsNull() {
                let memberName = document.getElementById("memberName").value.trim();
                if (memberName === "") {
                    message = "이름을 입력해주세요.";
                    check = false;
                }
                check = true;
            }

            // 성별 null 체크
            function checkMemberGenderIsNull() {
                let memberGender = document.getElementById("memberGender").value.trim();
                if (memberGender === "") {
                    message = "성별을 입력해주세요.";
                    check = false;
                }
                check = true;
            }

            // 주민번호 null 체크
            function checkMemberRegNoIsNull() {
                let memberRegNo = document.getElementById("memberRegNo").value.trim();
                if (memberRegNo === "") {
                    message = "주민번호를 입력해주세요.";
                    check = false;
                }
                check = true;
            }

            // 주민번호 숫자값 체크 및 처리
            function checkMemberRegNo() {
                let memberRegNo = document.getElementById("memberRegNo");
                if (isNaN(memberRegNo.value)) {
                    message = "주민번호는 숫자만 입력하세요.";
                    memberRegNo.value = "";
                    check = false;
                } else {
                    memberRegNo.value = memberRegNo.splice(0, 6) + "-" + memberRegNo.splice(6, 7);
                }
                check = true;
            }

            // 권한 null 체크
            function checkMemberAuthorityIsNull() {
                let authority = document.getElementById("authority").value.trim();
                if (authority === "") {
                    message = "권한을 입력해주세요.";
                    check = false;
                }
                check = true;
            }

            // 상태값 null 체크
            function checkMemberStatusIsNull() {
                let memberStatus = document.getElementById("memberStatus").value.trim();
                if (memberStatus === "") {
                    message = "회원 상태 값을 입력해주세요.";
                    check = false;
                }
                check = true;
            }

            // 입사일 null 체크
            function checkMemberJoinDateIsNull() {
                let joinDate = document.getElementById("joinDate").value.trim();
                if (joinDate === "") {
                    message = "입사일 값을 입력해주세요.";
                    check = false;
                }
                check = true;
            }

            // 유효성 테스트 함수 실행
            let functions = [checkMemberIdIsNull, checkMemberId, checkMemberPwIsNull, checkMemberNameIsNull,
                checkMemberPw, checkMemberGenderIsNull, checkMemberRegNoIsNull, checkMemberRegNo,
                checkMemberAuthorityIsNull, checkMemberStatusIsNull, checkMemberJoinDateIsNull];

            for (let i = 0; i < functions.length; i++) {
                functions[i]();
                if (check === false) {
                    alert(message);
                    break;
                }
                check = "allTrue";

                // 모두 통과 시 드디어 값 넣고 넘겨줌
                if (check == "allTrue") {
                    let newMember = document.querySelector('#newMember');

                    fetch(newMember.action, {
                        method: 'POST',
                        body: new FormData(newMember)
                    })
                        .then(response => {
                            if (response.ok) {
                                console.log('신규 사원 등록 성공!');
                            } else {
                                console.error('사원 등록 실패!');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });

                }
            }
        }


    </script>
</main>
</body>

</html>